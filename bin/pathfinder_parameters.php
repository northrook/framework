<?php

declare(strict_types=1);

include_once dirname( __DIR__, 1 ).'/vendor/autoload.php';

use Northrook\Filesystem\File;
use Support\Time;

$generated = new Time();
$generator = __FILE__;
$path      = \Support\getProjectRootDirectory( '.phpstorm.meta.php/.pathfinder.meta.php' );

$pathfinderParameters = "'".implode( "', '", array_keys( \Core\CoreBundle::PARAMETERS ) )."'";
$metaPhp              = <<<PHP
    <?php // {$generated->unixTimestamp}
    
    /*---------------------------------------------------------------------
    
       Name      : Pathfinder Parameters
       Generated : {$generated->datetime}
    
       This file is generated by {$generator}.
    
       Do not edit it manually.
    
    ---------------------------------------------------------------------*/
    
    namespace PHPSTORM_META;
    
    expectedArguments(
        \Core\Framework\Autowire\Pathfinder::pathfinder(),
        0,
        {$pathfinderParameters}
    );
    PHP;

$result = File::save( $path, $metaPhp );
\Core\Symfony\Console\Output::success( 'Pathfinder Parameters '.( $result ? 'created' : 'updated' ) );
\Core\Symfony\Console\Output::comment( "Saved to {$path}" );
